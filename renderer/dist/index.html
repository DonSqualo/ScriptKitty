<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ScriptKitten</title>
  <style>
    @font-face {
      font-family: 'Terminal';
      src: local('Courier New'), local('Consolas'), local('monospace');
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: #000;
      overflow: hidden;
      font-family: 'Courier New', Consolas, monospace;
      color: #ccc;
    }

    #main-view {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    #main-canvas {
      width: 100%;
      height: 100%;
      display: block;
      image-rendering: pixelated;
    }

    .tui-window {
      position: absolute;
      background: #000;
      border: 2px solid #888;
      box-shadow: 4px 4px 0 #333;
      min-width: 200px;
      display: none;
      z-index: 50;
    }

    .tui-window.visible {
      display: block;
    }

    .tui-titlebar {
      background: #888;
      color: #000;
      padding: 2px 8px;
      font-size: 12px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 2px;
      cursor: move;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
    }

    .tui-close {
      cursor: pointer;
      font-size: 14px;
      width: 16px;
      height: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .tui-close:hover {
      background: #666;
    }

    .tui-content {
      padding: 8px;
    }

    .tui-label {
      position: absolute;
      top: 8px;
      left: 12px;
      color: #666;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 3px;
      pointer-events: none;
    }

    .tui-status {
      position: absolute;
      bottom: 8px;
      left: 12px;
      color: #444;
      font-size: 10px;
      letter-spacing: 1px;
    }

    #graph-window {
      bottom: 20px;
      right: 20px;
      width: 320px;
    }

    #graph-canvas {
      width: 300px;
      height: 180px;
      background: #000;
      display: block;
    }

    #circuit-overlay {
      position: absolute;
      pointer-events: none;
      z-index: 100;
      display: none;
      transform-origin: top left;
    }

    #circuit-overlay.visible {
      display: block;
    }

    .scanline {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 0, 0, 0.1) 0px,
        rgba(0, 0, 0, 0.1) 1px,
        transparent 1px,
        transparent 2px
      );
      pointer-events: none;
      z-index: 9999;
    }

    .noise {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0.03;
      pointer-events: none;
      z-index: 9998;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    }
  </style>
  <script type="module" crossorigin src="/assets/index-D2Dst4tf.js"></script>
</head>
<body>
  <div class="noise"></div>
  <div class="scanline"></div>

  <div id="main-view">
    <canvas id="main-canvas"></canvas>
    <div class="tui-label">ScriptKitten</div>
    <div class="tui-status" id="status">CONNECTING...</div>
    <div id="circuit-overlay"></div>
  </div>

  <div id="graph-window" class="tui-window">
    <div class="tui-titlebar">
      <span>Bz Field Plot</span>
      <span class="tui-close" onclick="closeWindow('graph-window')">X</span>
    </div>
    <div class="tui-content">
      <canvas id="graph-canvas" width="300" height="180"></canvas>
    </div>
  </div>

  <div id="nanovna-window" class="tui-window" style="bottom: 220px; right: 20px; width: 320px;">
    <div class="tui-titlebar">
      <span>NanoVNA S11</span>
      <span class="tui-close" onclick="closeWindow('nanovna-window')">X</span>
    </div>
    <div class="tui-content">
      <canvas id="nanovna-canvas" width="300" height="180"></canvas>
    </div>
  </div>

  <script>
    function closeWindow(id) {
      document.getElementById(id).classList.remove('visible');
    }

    function openWindow(id) {
      document.getElementById(id).classList.add('visible');
    }

    // Draggable windows
    let topZIndex = 50;
    document.querySelectorAll('.tui-titlebar').forEach(titlebar => {
      let isDragging = false;
      let offsetX, offsetY;
      const win = titlebar.parentElement;

      titlebar.addEventListener('mousedown', (e) => {
        if (e.target.classList.contains('tui-close')) return;
        win.style.zIndex = ++topZIndex;
        isDragging = true;
        offsetX = e.clientX - win.offsetLeft;
        offsetY = e.clientY - win.offsetTop;
      });

      document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        win.style.left = (e.clientX - offsetX) + 'px';
        win.style.right = 'auto';
        win.style.top = (e.clientY - offsetY) + 'px';
        win.style.bottom = 'auto';
      });

      document.addEventListener('mouseup', () => {
        isDragging = false;
      });
    });
  </script>

</body>
</html>
